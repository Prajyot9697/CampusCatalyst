{% load static %}
{% block body %}
{% include 'recruiter_navigation.html' %}

<script>
  function checkpass() {
    // Validate Job Title
    var jobTitle = document.signup.jobtitle.value;
    var jobTitleRegex = /^[a-zA-Z\s]*$/;
    if (!jobTitleRegex.test(jobTitle)) {
      alert("Job Title should contain only letters.");
      document.signup.jobtitle.focus();
      return false;
    }

    // Validate Start Date
    var startDate = document.signup.startdate.value;
    if (startDate) {
      startDate = new Date(startDate);
      var currentDate = new Date();
      if (startDate < currentDate) {
        alert("Start Date should not be previous to the current date.");
        document.signup.startdate.focus();
        return false;
      }
    }

    // Validate End Date
    var endDate = document.signup.enddate.value;
    if (endDate) {
      endDate = new Date(endDate);
      if (startDate && endDate <= startDate) {
        alert("End Date should not be previous to or the same as the Start Date.");
        document.signup.enddate.focus();
        return false;
      }
    }

    // Validate Salary
    var salary = document.signup.salary.value;
    if (isNaN(salary) || salary <= 0) {
      alert("Salary should be a positive number.");
      document.signup.salary.focus();
      return false;
    }

    // Validate Experience
    var experience = document.signup.experience.value;
    var validInputRegex = /^[0-9-]+$/;
    if (!validInputRegex.test(experience) || experience < 0) {
      alert("Experience should be a positive number or a valid range.");
      document.signup.experience.focus();
      return false;
    }

    // Validate Company Location
    var companyLocation = document.signup.location.value;
    var locationRegex = /^[a-zA-Z0-9,\s]*$/;
    if (!locationRegex.test(companyLocation)) {
      alert("Company Location should contain only letters.");
      document.signup.location.focus();
      return false;
    }

    // Validate Skills and Description
    var skills = document.signup.skills.value;
    var description = document.signup.description.value;
    if (skills.trim() === "" || description.trim() === "") {
      alert("Skills and Description cannot be empty.");
      return false;
    }

    return true;
  }
</script>

<marquee style="font-family: 'Monotype Corsiva'; font-size: 25px; color: darkcolor; background-color: lightblue; font-weight: bold; margin-top: 1%;">
  Edit Job Details
</marquee>

<hr />
<form class="container mt-5" onsubmit="return checkpass();" name="signup" method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <!--  1st Row  -->
  <div class="form-row">
    <div class="form-group col-md-12">
      <label><b> Job Title </b></label>
      <input type="text" class="form-control" name="jobtitle" value="{{job.title}}" required />
    </div>
  </div>

  <!--  2nd Row  -->
  <div class="form-row">
    <div class="form-group col-md-6">
      <label><b> Start Date </b></label>
      <span style="color: red">[{{job.start_date}}]</span>
      <input type="date" class="form-control" name="startdate" />
    </div>

    <div class="form-group col-md-6">
      <label><b> End Date </b></label>
      <span style="color: red">[{{job.end_date}}]</span>
      <input type="date" class="form-control" name="enddate" />
    </div>
  </div>

  <!--  3rd Row  -->
  <div class="form-row">
    <div class="form-group col-md-6">
      <label><b> Salary (Per Month) </b></label>
      <input type="text" class="form-control" name="salary" value="{{job.salary}}" required />
    </div>

    <div class="form-group col-md-6">
      <img src="{{job.image.url}}" width="100" height="90" />
      <a href="{% url 'change_companylogo' job.id %}">Change Company Logo</a>
    </div>
  </div>

  <!--  4th Row  -->
  <div class="form-row">
    <div class="form-group col-md-6">
      <label><b> Experience (In Years) </b></label>
      <input type="text" class="form-control" name="experience" value="{{job.experience}}" required />
    </div>

    <div class="form-group col-md-6">
      <label><b> Company Location </b></label>
      <input type="text" class="form-control" name="location" value="{{job.location}}" required />
    </div>
  </div>

  <!--  5th Row  -->
  <div class="form-row">
    <div class="form-group col-md-12">
      <label><b> Skills </b></label>
      <input type="text" class="form-control" name="skills" value="{{job.skills}}" required />
    </div>
  </div>

  <!--  6th Row  -->
  <div class="form-row">
    <div class="form-group col-md-12">
      <label><b> Description </b></label>
      <textarea class="form-control" name="description" required>{{job.description}}</textarea>
    </div>
  </div>
  <input type="submit" value="Submit" class="btn btn-secondary my-3" style="width: 200px" />
</form>

{% include 'footer.html' %}

{% if error == "no" %}
<script>
  alert("Job Details have been Updated Successfully");
  window.location = ('{% url 'edit_job' job.id %}');
</script>
{% endif %}
{% if error == "yes" %}
<script>
  alert("Something went wrong, Try Again...");
</script>
{% endif %}
{% endblock body %}
